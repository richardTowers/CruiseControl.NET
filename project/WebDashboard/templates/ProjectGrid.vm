<!-- ProjectGrid.vm: Start -->

<!-- TODO: refresh button? Or replace with events sent from the server? -->

#if ($forceBuildMessage.Length > 0)
<div class="row" ng-controller="projectGridExceptions">
    <div class="col-lg-12">
        <alert type="info" close="closeAlert(0)" ng-show="shouldShowAlert(0)">
            $translations.Translate($forceBuildMessage)
        </alert>
    </div>
</div>
#end

#if ($exceptions.Length > 0)
<div class="row" ng-controller="projectGridExceptions">
    <div class="col-lg-12">
        #set ($counter = 0)
        #foreach ($exception in $exceptions)
        <alert type="danger" close="closeAlert($counter)" ng-show="shouldShowAlert($counter)">
            <p><strong>Error</strong> <small>(<strong>$exception.ServerName</strong> - $exception.Url)</small></p>
            <p>$exception.Message</p>
        </alert>
        #set ($counter = $counter + 1)
        #end
    </div>
</div>
#end


#if ($projectGrid.Length > 0)

<div class="row" ng-controller="projectGrid">
    <div class="col-lg-12">
        <div class="widget">
            <div class="widget-header input-group">
                <i class="fa fa-tasks"></i> Projects
                <label for="projectGridSearch" class="sr-only">Search projects</label>
                <input name="projectGridSearch" type="search" placeholder="Search" class="form-control pull-right" ng-model="projectGridSearch">
                <span class="input-group-addon">
                    <i class="fa fa-search"></i>
                </span>
            </div>
            <div class="widget-body no-padding">
                <div class="table-responsive">
                    <!-- TODO: make this table sortable / searchable: -->
                    <table class="table">
                        <thead>
                            <tr class="ProjectGridHeader">
                                <th>$translations.Translate("Last Build Status")</th>
                                <th>$translations.Translate("Project Name")</th>
                                <th>$translations.Translate("Last Build Time")</th>
                                <th>$translations.Translate("Next Build Time")</th>
                                <th>$translations.Translate("Last Build Label")</th>
                                <th>$translations.Translate("CCNet Status")</th>
                                <th>$translations.Translate("Activity")</th>
                                <th>$translations.Translate("Messages")</th>
                                #if ($wholeFarm)
                                <th>$translations.Translate("Server")</th>
                                #end
                                <th>$translations.Translate("Admin")</th>
                            </tr>
                        </thead>
                        <tbody>


                            #foreach ($projectGridRow in $projectGrid)

                            <!-- Hacky search filter: -->
                            <tr id="projectData$RowId" ng-show="shouldShowRow('$projectGridRow.Name$projectGridRow.ServerName$translations.Translate($projectGridRow.BuildStatus)')">
                                <td><span class="label label-$projectGridRow.BuildStatusClass">$translations.Translate($projectGridRow.BuildStatus)</span></td>
                                <td>
                                    <a href="$projectGridRow.Url" title="$projectGridRow.Description">$projectGridRow.Name</a>
                                </td>
                                <td><a href="server/$projectGridRow.ServerName/project/$projectGridRow.Name/ViewLatestBuildReport.aspx">$projectGridRow.LastBuildDate</a></td>
                                <td>$translations.Translate($projectGridRow.NextBuildTime)</td>
                                <td>$translations.Translate($projectGridRow.LastBuildLabel)</td>
                                <td class="status$projectGridRow.Status">$translations.Translate($projectGridRow.Status)</td>
                                <td class="activity$projectGridRow.Activity">$translations.Translate($projectGridRow.Activity.ToString())</td>
                                <td class="left">
                                    <ul>
                                        #if ($projectGridRow.Breakers.Length > 0)
                                        <li>$translations.Translate("Breakers : {0}", $projectGridRow.Breakers)</li>
                                        #end
                                        #if ($projectGridRow.Fixer.Length > 0)
                                        <li>$projectGridRow.Fixer</li>
                                        #end
                                        #if ($projectGridRow.FailingTasks.Length > 0)
                                        <li>$translations.Translate("Failing Tasks : {0}", $projectGridRow.FailingTasks)</li>
                                        #end
                                    </ul>
                                </td>
                                #if ($wholeFarm)
                                <td>$projectGridRow.ServerName</td>
                                #end
                                <td>
                                    <form method="post" ng-controller="projectGridForm" cc-submit>
                                        <input type="hidden" name="projectName" value="$projectGridRow.Name">
                                        <input type="hidden" name="serverName" value="$projectGridRow.ServerName">
                                        #if ($projectGridRow.allowForceBuild)
                                            #if($projectGridRow.ForceAbortBuildButtonValue == "Force")
                                            <input type="submit"
                                                   class="btn btn-primary btn-xs"
                                                   ng-click="checkParameters('$projectGridRow.ForceAbortBuildButtonName', '$projectGridRow.ForceAbortBuildButtonValue', '$projectGridRow.ParametersUrl')"
                                                   value="$translations.Translate($projectGridRow.ForceAbortBuildButtonValue)">
                                            #else
                                            <input type="submit"
                                                   class="btn btn-danger btn-xs"
                                                   ng-click="ccSubmit({name: '$projectGridRow.ForceAbortBuildButtonName', value: '$projectGridRow.ForceAbortBuildButtonValue'});"
                                                   value="$translations.Translate($projectGridRow.ForceAbortBuildButtonValue)">
                                            #end
                                        #end
                                        #if ($projectGridRow.AllowStartStopBuild)
                                            <input type="submit"
                                                   class="btn btn-warning btn-xs"
                                                   ng-click="ccSubmit({name: '$projectGridRow.StartStopButtonName', value: '$projectGridRow.StartStopButtonValue'});"
                                                   value="$translations.Translate($projectGridRow.StartStopButtonValue)">
                                        #end
                                    </form>
                                </td>
                            </tr>
                            #if ($projectGridRow.BuildStage.Length > 0)
                            <tr id="link$RowId" class="buildStatus">
                                #if ($wholeFarm)
                                <td colspan="10">$translations.FormatBuildStage($projectGridRow.BuildStage)</td>
                                #else
                                <td colspan="9">$translations.FormatBuildStage($projectGridRow.BuildStage)</td>
                                #end
                            </tr>
                            #end
                            #end
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
#end
<!-- ProjectGrid.vm: End -->
